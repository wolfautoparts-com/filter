<?php
use Wolf\Filter\Block\Navigation as B;
$b = $block; /** @var B $block */ /** @var B $b */
$config = $b->getConfigJson();
$categoriesByLevel = $config['categoriesByLevel'];
list($selectedCarContStyle, $selectedCarContStyle1) =
	!df_action_is('catalog_category_view', 'catalogsearch_result_index', 'cms_noroute_index')
	? ['', ''] : ['style="display: block;"', 'style="display: none;"']
;
?>
<div class='block' style='margin-bottom: 0; min-height: 40px;'>
	<div class='garage-selected-car-cont' <?= $selectedCarContStyle; ?>>
		Selected Car: &nbsp;&nbsp;
		<?php if ($config['customer_garage_uri'] && !$config['customer_garage_is_empty']) { ?>
			<a
				class="garage-selected-car-link"
				href="<?= $config['customer_garage_uri']; ?>"
				style="text-transform: capitalize;"
			><?= $config['customer_garage_uri_name']; ?></a>
		<?php } else { ?>
			<a class="garage-selected-car-link" href="#"><?= __('No Car Selected'); ?></a>
		<?php } ?>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<button class="btn-link change-car-btn">Change Car</button>
	</div>
	<div class="block nav-categoryfilters garage-cont" <?= $selectedCarContStyle1; ?>>
		<div class="block-title title-row">
			<div><strong><span><?= $b['title'] ?></span></strong></div>
			<div><div class="loading-message"><?= $b['loading_message'] ?: 'Loading...' ?></div></div>
		</div>
		<div style='garage-block'>
			<div class='garage-block-cars'>
				<form action='' class='row change-car-form' id='change-car' method='post' name='change-car-form'
				></form>
			</div>
			<div class="garage-block-filters">
				<form action='' class='row category-form' id='add-new-car' method='post' name='category-form'>
					<div id="cd-<?= $b->getNameInLayout() ?>" class="block-content row">
						<?php
						$lastSelect = false;
						$levels = $b['levels'];
						for ($l = 0; $l < $levels; $l++) {
							if ($l == ($levels - 1)) {
								$lastSelect = true;
							}
							$label = $b->getSelectLabel($l); /** @var string $label */
							$j = $l + 1; /** @var int $j */
							echo df_tag('div', df_cc_s('select-outer', !$lastSelect ? '' : 'select-outer-last'), [
								'outside' !== $b->getLabelsEmbedded() || !$label ? null : df_tag('label', [], $label)
								,df_tag('select'
									,[
										'class' => 'category-filter-select'
										,'dataId' => $j
										,'id' => "{$b->getNameInLayout()}$j"
									]
									,array_merge(
										[
											df_tag('option', ['value' => ''],
												'embedded' === $b->getLabelsEmbedded() && $label
												? $label : 'Please Select'
											)
										]
										,$l || !($dfCats = dfa($categoriesByLevel, $l)) ? [] : df_map(
											$dfCats, function($c) {return df_tag('option'
												,['dataUrl' => $c['url'], 'value' => $c['id']]
												,$c['name']
											);}
										)
									)
								)
							]);
						} ?>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<div class='clearfix'></div>
<script type='text/javascript'>
	requirejs(['jquery', 'categoryFilter'], function($) {
		$('#cd-<?= $b->getNameInLayout() ?>').categoryfilter({
			'labelembedded': '<?= $b->getLabelsEmbedded() ?>'
			,'levels': '<?= $b['levels'] ?>'
			,'nameInLayout': '<?= $b->getNameInLayout() ?>'
			,'url': '<?= $b->getBaseUrl(); ?>categoryfinder/index/change/'
		});
	});
</script>